{
  "query": "loadConfiguration strategy.vip.threshold",
  "focus_node": "DemoRunner.loadConfiguration",
  "seed_nodes": [
    {
      "node_id": "DemoRunner.loadConfiguration",
      "score": 0.5448869577479918
    },
    {
      "node_id": "AbstractBaseStrategy.minScoreThreshold",
      "score": 0.21781615111375777
    },
    {
      "node_id": "EXTERNAL::Properties.load",
      "score": 0.21275227113365114
    },
    {
      "node_id": "IPromotionStrategy.getStrategyName",
      "score": 0.09977931535532623
    },
    {
      "node_id": "HighNetWorthStrategy.getStrategyName",
      "score": 0.08891327743657995
    }
  ],
  "nodes": [
    {
      "node_id": "DemoRunner.loadConfiguration",
      "name": "loadConfiguration",
      "type": "Method",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "start_line": 52,
      "end_line": 64,
      "signature": "private static void loadConfiguration()",
      "docstring": "",
      "snippet": "    private static void loadConfiguration() {\n        try (InputStream input = DemoRunner.class.getClassLoader().getResourceAsStream(\"application.properties\")) {\n            Properties prop = new Properties();\n            if (input == null) {\n                System.out.println(\"Sorry, unable to find application.properties\");\n                return;\n            }\n            prop.load(input);\n            System.out.println(\"Loaded Config: Strategy Threshold = \" + prop.getProperty(\"strategy.vip.threshold\"));\n        } catch (IOException ex) {\n            ex.printStackTrace();\n        }\n    }\n",
      "role": "focus",
      "roles": [
        "focus",
        "same_class_member",
        "same_file_helper",
        "seed",
        "shared_field_reader"
      ],
      "highlight_span": {
        "start_line": 52,
        "end_line": 52
      },
      "why": [
        "focus node",
        "seed via vector search (score=0.545)",
        "same class member of DemoRunner",
        "shares field EXTERNAL::System.out (READS)",
        "same file helper (/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java)"
      ]
    },
    {
      "node_id": "AbstractBaseStrategy.minScoreThreshold",
      "name": "minScoreThreshold",
      "type": "Field",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/strategy/AbstractBaseStrategy.java",
      "start_line": 8,
      "end_line": 8,
      "signature": "double minScoreThreshold",
      "docstring": "",
      "snippet": "    protected double minScoreThreshold;\n",
      "role": "seed",
      "roles": [
        "seed"
      ],
      "highlight_span": {
        "start_line": 8,
        "end_line": 8
      },
      "why": [
        "seed via vector search (score=0.218)"
      ]
    },
    {
      "node_id": "EXTERNAL::Properties.load",
      "name": "Properties.load",
      "type": "External",
      "file_path": "",
      "start_line": 0,
      "end_line": 0,
      "signature": "",
      "docstring": "",
      "snippet": "",
      "role": "seed",
      "roles": [
        "callee",
        "seed"
      ],
      "highlight_span": null,
      "why": [
        "seed via vector search (score=0.213)",
        "call-graph neighbor (CALLEE, depth=1)"
      ]
    },
    {
      "node_id": "HighNetWorthStrategy.getStrategyName",
      "name": "getStrategyName",
      "type": "Method",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/strategy/impl/HighNetWorthStrategy.java",
      "start_line": 12,
      "end_line": 15,
      "signature": "@Override public String getStrategyName()",
      "docstring": "",
      "snippet": "    @Override\n    public String getStrategyName() {\n        return \"VIP_WEALTH_MANAGEMENT\";\n    }\n",
      "role": "seed",
      "roles": [
        "seed"
      ],
      "highlight_span": {
        "start_line": 13,
        "end_line": 13
      },
      "why": [
        "seed via vector search (score=0.089)"
      ]
    },
    {
      "node_id": "IPromotionStrategy.getStrategyName",
      "name": "getStrategyName",
      "type": "Method",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/strategy/IPromotionStrategy.java",
      "start_line": 6,
      "end_line": 6,
      "signature": "String getStrategyName();",
      "docstring": "",
      "snippet": "    String getStrategyName();\n",
      "role": "seed",
      "roles": [
        "seed"
      ],
      "highlight_span": {
        "start_line": 6,
        "end_line": 6
      },
      "why": [
        "seed via vector search (score=0.100)"
      ]
    },
    {
      "node_id": "DemoRunner.main",
      "name": "main",
      "type": "Method",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "start_line": 17,
      "end_line": 50,
      "signature": "public static void main(String[] args)",
      "docstring": "",
      "snippet": "    public static void main(String[] args) {\n        System.out.println(\">>> Initializing ICBC Marketing Decision Engine...\");\n        \n        // 1. 模拟加载配置 (假装读取 application.properties)\n        loadConfiguration();\n\n        // 2. 初始化引擎 (Service Layer)\n        CampaignDecisionEngine engine = new CampaignDecisionEngine();\n\n        // 3. 模拟 Case A: 普通用户 (将被 LegacyScoringUtil 拦截或计算低分)\n        System.out.println(\"\\n--- Case A: Processing Regular User ---\");\n        Map<String, Object> regularUserFeatures = new HashMap<>();\n        regularUserFeatures.put(\"last_1h_txn_amt\", 50.0);\n        regularUserFeatures.put(\"login_count_7d\", 2);\n        regularUserFeatures.put(\"customer_segment\", \"REGULAR\");\n        \n        String offerA = engine.decideOffer(\"U_1001\", regularUserFeatures);\n        System.out.println(\"Result for U_1001: \" + offerA);\n\n        // 4. 模拟 Case B: 高净值 VIP 用户 (将触发 HighNetWorthStrategy)\n        System.out.println(\"\\n--- Case B: Processing VIP User ---\");\n        Map<String, Object> vipFeatures = new HashMap<>();\n        vipFeatures.put(\"last_1h_txn_amt\", 50000.0);\n        vipFeatures.put(\"login_count_7d\", 20);\n        vipFeatures.put(\"customer_segment\", \"VIP\"); // 这里的 VIP 字符串对应 Strategy 里的判断\n        \n        String offerB = engine.decideOffer(\"U_8888\", vipFeatures);\n        System.out.println(\"Result for U_8888: \" + offerB);\n\n        // 5. 模拟 Case C: 黑名单用户 (触发 Risk Control)\n        System.out.println(\"\\n--- Case C: Processing Blacklisted User ---\");\n        String offerC = engine.decideOffer(\"B_BadGuy\", regularUserFeatures);\n        System.out.println(\"Result for B_BadGuy: \" + offerC);\n    }\n",
      "role": "caller",
      "roles": [
        "caller",
        "same_class_member",
        "same_file_helper",
        "shared_field_reader"
      ],
      "highlight_span": {
        "start_line": 17,
        "end_line": 17
      },
      "why": [
        "call-graph neighbor (CALLER, depth=1)",
        "same class member of DemoRunner",
        "shares field EXTERNAL::System.out (READS)",
        "same file helper (/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java)"
      ]
    },
    {
      "node_id": "EXTERNAL::Properties.getProperty",
      "name": "Properties.getProperty",
      "type": "External",
      "file_path": "",
      "start_line": 0,
      "end_line": 0,
      "signature": "",
      "docstring": "",
      "snippet": "",
      "role": "callee",
      "roles": [
        "callee"
      ],
      "highlight_span": null,
      "why": [
        "call-graph neighbor (CALLEE, depth=1)"
      ]
    },
    {
      "node_id": "EXTERNAL::System.out.println",
      "name": "System.out.println",
      "type": "External",
      "file_path": "",
      "start_line": 0,
      "end_line": 0,
      "signature": "",
      "docstring": "",
      "snippet": "",
      "role": "callee",
      "roles": [
        "callee"
      ],
      "highlight_span": null,
      "why": [
        "call-graph neighbor (CALLEE, depth=1)"
      ]
    },
    {
      "node_id": "UNRESOLVED::getClassLoader",
      "name": "getClassLoader",
      "type": "Unresolved",
      "file_path": "",
      "start_line": 0,
      "end_line": 0,
      "signature": "",
      "docstring": "",
      "snippet": "",
      "role": "callee",
      "roles": [
        "callee"
      ],
      "highlight_span": null,
      "why": [
        "call-graph neighbor (CALLEE, depth=1)"
      ]
    },
    {
      "node_id": "UNRESOLVED::getResourceAsStream",
      "name": "getResourceAsStream",
      "type": "Unresolved",
      "file_path": "",
      "start_line": 0,
      "end_line": 0,
      "signature": "",
      "docstring": "",
      "snippet": "",
      "role": "callee",
      "roles": [
        "callee"
      ],
      "highlight_span": null,
      "why": [
        "call-graph neighbor (CALLEE, depth=1)"
      ]
    },
    {
      "node_id": "UNRESOLVED::printStackTrace",
      "name": "printStackTrace",
      "type": "Unresolved",
      "file_path": "",
      "start_line": 0,
      "end_line": 0,
      "signature": "",
      "docstring": "",
      "snippet": "",
      "role": "callee",
      "roles": [
        "callee"
      ],
      "highlight_span": null,
      "why": [
        "call-graph neighbor (CALLEE, depth=1)"
      ]
    },
    {
      "node_id": "CampaignDecisionEngine.decideOffer",
      "name": "decideOffer",
      "type": "Method",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/service/CampaignDecisionEngine.java",
      "start_line": 27,
      "end_line": 61,
      "signature": "public String decideOffer(String userId, Map<String, Object> realTimeFeatures)",
      "docstring": "",
      "snippet": "    public String decideOffer(String userId, Map<String, Object> realTimeFeatures) {\n        System.out.println(\"Processing decision for user: \" + userId);\n\n        // =========================================================\n        // Step 1: Risk Control Layer (Pre-computation) 【风控层】\n        // =========================================================\n        \n        // 检查 1: 黑名单风控\n        // The dependency graph should catch this reference to LegacyScoringUtil\n        if (LegacyScoringUtil.isBlacklisted(userId)) {\n            return \"BLOCK: User is Blacklisted (Risk Control)\";\n        }\n\n        // 检查 2: 基础指标门槛风控\n        // The prompt will ask to refactor this method signature!\n        // [Graph RAG Key Point]: If 'calculateBaseScore' changes, this line breaks.\n        double baseScore = LegacyScoringUtil.calculateBaseScore(realTimeFeatures);\n        \n        if (baseScore < 0) {\n            return \"BLOCK: Activity Score too low (Metric Filter)\";\n        }\n\n        // =========================================================\n        // Step 2: Marketing Strategy Layer (Recommendation) 【推荐层】\n        // =========================================================\n        \n        for (IPromotionStrategy strategy : strategies) {\n            // Strategies ALSO depend on the metrics calculated above\n            if (strategy.isApplicable(realTimeFeatures)) {\n                return strategy.execute(userId, realTimeFeatures);\n            }\n        }\n\n        return \"DEFAULT: General Savings Promo\";\n    }\n",
      "role": "shared_field_reader",
      "roles": [
        "shared_field_reader"
      ],
      "highlight_span": {
        "start_line": 27,
        "end_line": 27
      },
      "why": [
        "shares field EXTERNAL::System.out (READS)"
      ]
    },
    {
      "node_id": "EXTERNAL::System.out",
      "name": "System.out",
      "type": "External",
      "file_path": "",
      "start_line": 0,
      "end_line": 0,
      "signature": "",
      "docstring": "",
      "snippet": "",
      "role": "shared_field",
      "roles": [
        "shared_field"
      ],
      "highlight_span": null,
      "why": [
        "shared state (field accessed by focus)"
      ]
    },
    {
      "node_id": "DemoRunner",
      "name": "DemoRunner",
      "type": "Class",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "start_line": 15,
      "end_line": 65,
      "signature": "public class DemoRunner",
      "docstring": "/**\n * [Simulator Entry Point]\n * This class simulates the environment where Flink calls our Engine.\n */",
      "snippet": "public class DemoRunner {\n\n    public static void main(String[] args) {\n        System.out.println(\">>> Initializing ICBC Marketing Decision Engine...\");\n        \n        // 1. 模拟加载配置 (假装读取 application.properties)\n        loadConfiguration();\n\n        // 2. 初始化引擎 (Service Layer)\n        CampaignDecisionEngine engine = new CampaignDecisionEngine();\n\n        // 3. 模拟 Case A: 普通用户 (将被 LegacyScoringUtil 拦截或计算低分)\n        System.out.println(\"\\n--- Case A: Processing Regular User ---\");\n        Map<String, Object> regularUserFeatures = new HashMap<>();\n        regularUserFeatures.put(\"last_1h_txn_amt\", 50.0);\n        regularUserFeatures.put(\"login_count_7d\", 2);\n        regularUserFeatures.put(\"customer_segment\", \"REGULAR\");\n        \n        String offerA = engine.decideOffer(\"U_1001\", regularUserFeatures);\n        System.out.println(\"Result for U_1001: \" + offerA);\n\n        // 4. 模拟 Case B: 高净值 VIP 用户 (将触发 HighNetWorthStrategy)\n        System.out.println(\"\\n--- Case B: Processing VIP User ---\");\n        Map<String, Object> vipFeatures = new HashMap<>();\n        vipFeatures.put(\"last_1h_txn_amt\", 50000.0);\n        vipFeatures.put(\"login_count_7d\", 20);\n        vipFeatures.put(\"customer_segment\", \"VIP\"); // 这里的 VIP 字符串对应 Strategy 里的判断\n        \n        String offerB = engine.decideOffer(\"U_8888\", vipFeatures);\n        System.out.println(\"Result for U_8888: \" + offerB);\n\n        // 5. 模拟 Case C: 黑名单用户 (触发 Risk Control)\n        System.out.println(\"\\n--- Case C: Processing Blacklisted User ---\");\n        String offerC = engine.decideOffer(\"B_BadGuy\", regularUserFeatures);\n        System.out.println(\"Result for B_BadGuy: \" + offerC);\n    }\n\n    private static void loadConfiguration() {\n        try (InputStream input = DemoRunner.class.getClassLoader().getResourceAsStream(\"application.properties\")) {\n            Properties prop = new Properties();\n            if (input == null) {\n                System.out.println(\"Sorry, unable to find application.properties\");\n                return;\n            }\n            prop.load(input);\n            System.out.println(\"Loaded Config: Strategy Threshold = \" + prop.getProperty(\"strategy.vip.threshold\"));\n        } catch (IOException ex) {\n            ex.printStackTrace();\n        }\n    }\n}",
      "role": "same_file_helper",
      "roles": [
        "same_file_helper"
      ],
      "highlight_span": {
        "start_line": 15,
        "end_line": 15
      },
      "why": [
        "same file helper (/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java)"
      ]
    }
  ],
  "edges": [
    {
      "source": "DemoRunner",
      "target": "DemoRunner.loadConfiguration",
      "relation": "CONTAINS",
      "file_path": null,
      "line": null
    },
    {
      "source": "DemoRunner",
      "target": "DemoRunner.main",
      "relation": "CONTAINS",
      "file_path": null,
      "line": null
    },
    {
      "source": "DemoRunner.loadConfiguration",
      "target": "UNRESOLVED::printStackTrace",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 62
    },
    {
      "source": "DemoRunner.loadConfiguration",
      "target": "EXTERNAL::System.out.println",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 56
    },
    {
      "source": "DemoRunner.loadConfiguration",
      "target": "EXTERNAL::Properties.getProperty",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 60
    },
    {
      "source": "DemoRunner.loadConfiguration",
      "target": "EXTERNAL::Properties.load",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 59
    },
    {
      "source": "DemoRunner.loadConfiguration",
      "target": "UNRESOLVED::getResourceAsStream",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 53
    },
    {
      "source": "DemoRunner.loadConfiguration",
      "target": "UNRESOLVED::getClassLoader",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 53
    },
    {
      "source": "DemoRunner.loadConfiguration",
      "target": "EXTERNAL::System.out",
      "relation": "READS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 56
    },
    {
      "source": "DemoRunner.main",
      "target": "EXTERNAL::System.out.println",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 18
    },
    {
      "source": "DemoRunner.main",
      "target": "CampaignDecisionEngine.decideOffer",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 33
    },
    {
      "source": "DemoRunner.main",
      "target": "DemoRunner.loadConfiguration",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 21
    },
    {
      "source": "DemoRunner.main",
      "target": "EXTERNAL::System.out",
      "relation": "READS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/DemoRunner.java",
      "line": 18
    },
    {
      "source": "CampaignDecisionEngine.decideOffer",
      "target": "EXTERNAL::System.out.println",
      "relation": "CALLS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/service/CampaignDecisionEngine.java",
      "line": 28
    },
    {
      "source": "CampaignDecisionEngine.decideOffer",
      "target": "EXTERNAL::System.out",
      "relation": "READS",
      "file_path": "/Users/lixiaoying/lxy/code/Code Refactoring/graph_rag_context_engine/data/marketing-demo/src/main/java/com/icbc/marketing/service/CampaignDecisionEngine.java",
      "line": 28
    }
  ],
  "focus": {
    "node_id": "DemoRunner.loadConfiguration"
  },
  "call_graph": {
    "callees": [
      {
        "node_id": "UNRESOLVED::printStackTrace",
        "depth": 1
      },
      {
        "node_id": "EXTERNAL::System.out.println",
        "depth": 1
      },
      {
        "node_id": "EXTERNAL::Properties.getProperty",
        "depth": 1
      },
      {
        "node_id": "EXTERNAL::Properties.load",
        "depth": 1
      },
      {
        "node_id": "UNRESOLVED::getResourceAsStream",
        "depth": 1
      },
      {
        "node_id": "UNRESOLVED::getClassLoader",
        "depth": 1
      }
    ],
    "callers": [
      {
        "node_id": "DemoRunner.main",
        "depth": 1
      }
    ]
  },
  "data_flow": {
    "read_fields": [
      "EXTERNAL::System.out"
    ],
    "written_fields": []
  },
  "same_class": [
    "DemoRunner",
    "DemoRunner.loadConfiguration",
    "DemoRunner.main"
  ],
  "same_file": [
    "DemoRunner",
    "DemoRunner.loadConfiguration",
    "DemoRunner.main"
  ],
  "stats": {
    "seed_top_k": 5,
    "hops": 2,
    "selected_nodes": 14,
    "selected_edges": 15
  }
}